<script src="./wasm_exec.js"></script>
<script>
    (async() => {
        let start = Date.now();
        console.log("loading go env and wasm...");
        const go = new Go();
        let wasmModule = await WebAssembly.instantiateStreaming(fetch("./prover.wasm"), go.importObject);
        go.run(wasmModule.instance);

        console.log("reading artifacts...");

        let resCCS = await fetch("/artifacts/zkcensus.ccs");
        let ccsBuff = await resCCS.arrayBuffer();
        let ccs = new Uint8Array(ccsBuff);
        console.log("(1/4)")

        let resSRS = await fetch("/artifacts/zkcensus.srs");
        let srsBuff = await resSRS.arrayBuffer();
        let srs = new Uint8Array(srsBuff);
        console.log("(2/4)")

        let resPKey = await fetch("/artifacts/zkcensus.pkey");
        let pKeyBuff = await resPKey.arrayBuffer();
        let pKey = new Uint8Array(pKeyBuff);
        console.log("(3/4)")

        let resWitness = await fetch("/artifacts/zkcensus.witness");
        let witnessBuff = await resWitness.arrayBuffer();
        let witness = new Uint8Array(witnessBuff);
        console.log("(4/4)")

        console.log("generating proof...")
        console.log(generateProof(ccs, srs, pKey, witness));
        let end = Date.now();
        let elapsed = end - start;
        console.log("Finished!", `${elapsed / 1000}s`);
    })();
</script>

<!--
<script>
    (async() => {
        var myWorker = new Worker("worker.js");

        const promise = new Promise((resolve, reject) => {
            myWorker.onmessage = (event) => {
                if (event.data.done) {
                    resolve();
                    return;
                }
                if (event.data.error) {
                    reject(event.data.error);
                    return;
                }
            };
        });
        myWorker.postMessage("");
        return promise;
    })();
</script>-->